<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru"
      th:with="theme=${currentTheme != null ? currentTheme : 'light'}"
      th:attr="data-theme=${currentTheme}">
<head>
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - TARENO</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/nav.css}">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body class="profile-page">
<div th:replace="~{fragments/nav :: navbar}"></div>

<main class="profile-main">
    <div class="profile-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="profile-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                    <p class="profile-subtitle">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="row">
            <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
            <div class="col-lg-3">
                <div class="profile-sidebar">
                    <div class="card sidebar-card">
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <a th:href="@{/profile}" class="list-group-item list-group-item-action">
                                    <i class="fas fa-user me-2"></i>–ü—Ä–æ—Ñ–∏–ª—å
                                </a>
                                <a th:href="@{/cart}" class="list-group-item list-group-item-action">
                                    <i class="fas fa-shopping-cart me-2"></i>–ö–æ—Ä–∑–∏–Ω–∞
                                </a>
                                <a th:href="@{/api/favorites/page}" class="list-group-item list-group-item-action">
                                    <i class="fas fa-heart me-2"></i>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                                </a>
                                <a th:href="@{/order-history}" class="list-group-item list-group-item-action">
                                    <i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
                                </a>
                                <a th:href="@{/settings}" class="list-group-item list-group-item-action active">
                                    <i class="fas fa-cog me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <form th:action="@{/settings/change-password}" method="post">
                    <div class="mb-3">
                        <label class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" name="currentPassword"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" name="newPassword"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required
                               minlength="6">
                        <div class="form-text">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</label>
                        <input type="password" class="form-control" name="confirmPassword"
                               placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-key me-2"></i>–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </button>
                        <a th:href="@{/forgot-password}" class="btn btn-link text-muted">
                            <i class="fas fa-question-circle me-1"></i>–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
                        </a>
                    </div>
                </form>
                <form th:action="@{/settings/update}" method="post" id="settingsForm">
                    <div class="card profile-card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-palette me-2"></i>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</label>
                                <select class="form-select" name="theme" id="themeSelect">
                                    <option value="light" th:selected="${user.theme == 'light'}">
                                        üåû –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
                                    </option>
                                    <option value="dark" th:selected="${user.theme == 'dark'}">
                                        üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
                                    </option>
                                </select>
                                <div class="form-text">
                                    –í–ª–∏—è–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –§–æ—Ä–º–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="card profile-card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-language me-2"></i>–§–æ—Ä–º–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã</label>
                                        <select class="form-select" name="dateFormat">
                                            <option value="dd.MM.yyyy" th:selected="${user.dateFormat == 'dd.MM.yyyy'}">
                                                –î–î.–ú–ú.–ì–ì–ì–ì (31.12.2023)
                                            </option>
                                            <option value="dd/MM/yyyy" th:selected="${user.dateFormat == 'dd/MM/yyyy'}">
                                                –î–î/–ú–ú/–ì–ì–ì–ì (31/12/2023)
                                            </option>
                                            <option value="yyyy-MM-dd" th:selected="${user.dateFormat == 'yyyy-MM-dd'}">
                                                –ì–ì–ì–ì-–ú–ú-–î–î (2023-12-31)
                                            </option>
                                            <option value="MM/dd/yyyy" th:selected="${user.dateFormat == 'MM/dd/yyyy'}">
                                                –ú–ú/–î–î/–ì–ì–ì–ì (12/31/2023)
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–§–æ—Ä–º–∞—Ç —á–∏—Å–µ–ª</label>
                                        <select class="form-select" name="numberFormat">
                                            <option value="COMMA" th:selected="${user.numberFormat == 'COMMA'}">
                                                1,000.50 (–∑–∞–ø—è—Ç–∞—è –¥–ª—è —Ç—ã—Å—è—á)
                                            </option>
                                            <option value="SPACE" th:selected="${user.numberFormat == 'SPACE'}">
                                                1 000.50 (–ø—Ä–æ–±–µ–ª –¥–ª—è —Ç—ã—Å—è—á)
                                            </option>
                                            <option value="DOT" th:selected="${user.numberFormat == 'DOT'}">
                                                1.000,50 (—Ç–æ—á–∫–∞ –¥–ª—è —Ç—ã—Å—è—á)
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="card profile-card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-desktop me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">–≠–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</label>
                                <select class="form-select" name="pageSize">
                                    <option value="5" th:selected="${user.pageSize == 5}">5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤</option>
                                    <option value="10" th:selected="${user.pageSize == 10}">10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤</option>
                                    <option value="20" th:selected="${user.pageSize == 20}">20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤</option>
                                    <option value="50" th:selected="${user.pageSize == 50}">50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤</option>
                                </select>
                                <div class="form-text">
                                    –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤, –∑–∞–∫–∞–∑–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card profile-card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">–¢–µ–∫—É—â–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</label>
                                <textarea class="form-control" name="savedFilters" rows="3"
                                          placeholder='–§–∏–ª—å—Ç—Ä—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏'
                                          th:text="${user.savedFilters}" readonly></textarea>
                                <div class="form-text">
                                    –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
                            <div class="d-flex gap-2 flex-wrap">
                                <a th:href="@{/catalog/apply-saved-filters}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-play me-1"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                                </a>
                                <a th:href="@{/catalog/clear-saved-filters}" class="btn btn-outline-danger btn-sm">
                                    <i class="fas fa-trash me-1"></i>–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card profile-card border-danger mt-4">
                        <div class="card-header bg-danger text-white">
                            <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i></h5>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center mb-4">
                                <div class="col-md-8">
                                    <h6 class="text-danger mb-2">
                                        <i class="fas fa-sign-out-alt me-2"></i>–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                                    </h6>
                                    <p class="text-muted small mb-0">–ó–∞–≤–µ—Ä—à–∏—Ç —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é. –í—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.</p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <a th:href="@{/logout}" class="btn btn-outline-danger btn-logout">
                                        <i class="fas fa-door-open me-2"></i>–í—ã–π—Ç–∏
                                    </a>
                                </div>
                            </div>

                            <hr class="my-4 border-danger">

                            <!-- –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="text-danger mb-2">
                                        <i class="fas fa-skull-crossbones me-2"></i>–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
                                    </h6>
                                    <p class="text-muted small mb-0">
                                        –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –∑–∞–∫–∞–∑—ã –∏ –∏—Å—Ç–æ—Ä–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
                                    </p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <a th:href="@{/confirm-delete-account}" class="btn btn-danger btn-delete-account">
                                        <i class="fas fa-trash-alt me-2"></i>–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="card profile-card">
                        <div class="card-body">
                            <div class="d-flex gap-2 flex-wrap">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetToDefaults()">
                                    <i class="fas fa-undo me-2"></i>–°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—è–º
                                </button>
                                <a th:href="@{/profile}" class="btn btn-outline-secondary ms-auto">
                                    <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>